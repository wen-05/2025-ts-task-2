import{a as L,d as C,u as $,o as R,b as O,e as i,f as u,g as e,m as x,t as o,F as v,n as k,r as _,q as D,p as g}from"./index-B495Ppqm.js";import{M as P,_ as A}from"./DeleteModal.vue_vue_type_script_setup_true_lang-CSGWqz1N.js";const T="https://ec-course-api.hexschool.io",S="wen-typescript-api",f=L.create({baseURL:T});f.interceptors.request.use(n=>{const p=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return p&&(n.headers.Authorization=p),n},n=>Promise.reject(n));f.interceptors.response.use(n=>Promise.resolve(n),n=>Promise.reject(n.response.data));const z=n=>f.get(`/v2/api/${S}/admin/orders`,{params:n}),N=n=>f.delete(`/v2/api/${S}/admin/order/${n}`),B={class:"modal-dialog modal-dialog-centered modal-lg"},E={class:"modal-content rounded-lg"},U={class:"modal-body"},V={id:"modalOrderNumber"},W={id:"modalOrderDate"},q={id:"modalCustomerName"},F={id:"modalShippingAddress"},j={id:"modalCustomerEmail"},G={id:"modalCustomerPhone"},H={class:"table table-bordered"},I={class:"h5 text-end"},J={id:"modalOrderAmount",class:"text-danger"},K=C({__name:"OrderDetailModal",props:{order:{}},setup(n,{expose:p}){const a=n,m=$("modalRef");let s=null;return R(()=>{m.value&&(s=new P(m.value))}),O(()=>{s&&s.dispose()}),p({openModal:()=>{s&&s.show()},closeModal:()=>{s&&s.hide()}}),(y,t)=>(u(),i("div",{ref_key:"modalRef",ref:m,class:"modal fade",id:"orderDetailModal",tabindex:"-1","aria-labelledby":"orderDetailModalLabel","aria-hidden":"true"},[e("div",B,[e("div",E,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"orderDetailModalLabel"},"訂單詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",U,[e("p",null,[t[0]||(t[0]=e("strong",null,"訂單編號:",-1)),t[1]||(t[1]=x()),e("span",V,o(a.order.id),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"日期:",-1)),e("span",W,o(new Date(a.order.create_at*1e3).toLocaleDateString()),1)]),e("p",null,[t[3]||(t[3]=e("strong",null,"客戶名稱:",-1)),e("span",q,o(a.order.user.name),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"地址:",-1)),e("span",F,o(a.order.user.address),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Email:",-1)),e("span",j,o(a.order.user.email),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"聯絡電話:",-1)),e("span",G,o(a.order.user.tel),1)]),t[10]||(t[10]=e("hr",null,null,-1)),t[11]||(t[11]=e("h6",null,"訂購商品",-1)),e("table",H,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"商品名稱"),e("th",null,"數量"),e("th",null,"小計")])],-1)),e("tbody",null,[(u(!0),i(v,null,k(a.order.products,b=>(u(),i("tr",{key:b.id},[e("td",null,o(b.product.title),1),e("td",null,o(b.qty),1),e("td",null,o(b.final_total.toLocaleString("zh-TW")),1)]))),128))])]),t[12]||(t[12]=e("hr",null,null,-1)),e("p",I,[t[8]||(t[8]=e("strong",null,"總金額:",-1)),e("span",J,o(a.order.total.toLocaleString("zh-TW")),1),t[9]||(t[9]=x(" 元 ",-1))])]),t[14]||(t[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 關閉 ")],-1))])])],512))}}),Q={class:"card shadow-sm rounded-lg flex-grow-1"},X={class:"card-body p-4"},Y={class:"table-responsive"},Z={class:"table table-hover align-middle"},ee={class:"order-number"},te={class:"text-nowrap"},le=["onClick"],se=["onClick"],oe={class:"d-flex justify-content-center mt-4"},ne={class:"pagination"},ae={class:"page-item"},de=["disabled"],re={class:"page-item"},ie=["onClick","disabled"],ue={class:"page-item"},pe=["disabled"],be=C({__name:"OrderManagement",setup(n){const p=$("orderDetailModalRef"),a=$("deleteModalRef"),m=_({create_at:0,id:"",is_paid:!1,total:0,message:"",products:{},user:{address:"",email:"",name:"",tel:""},num:0}),s=_("1"),h=_([]),c=_({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),y=async()=>{try{const r=await z({page:s.value});h.value=r.data.orders,c.value=r.data.pagination}catch{alert("取得訂單列表失敗")}};R(()=>{y()});const t=r=>{m.value=r,p.value?.openModal()},b=r=>{a.value?.openModal(()=>w(r))},w=async r=>{try{await N(r)}catch{alert("刪除訂單失敗")}finally{y()}};return(r,d)=>(u(),i(v,null,[e("div",Q,[e("div",X,[e("div",Y,[e("table",Z,[d[2]||(d[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"日期"),e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"品項"),e("th",{scope:"col"},"金額"),e("th",{scope:"col"},"訂單狀態"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(u(!0),i(v,null,k(h.value,l=>(u(),i("tr",{key:l.id},[e("td",null,o(new Date(l.create_at*1e3).toLocaleDateString("zh-TW")),1),e("td",ee,o(l.id),1),e("td",null,o(Object.keys(l.products).length),1),e("td",null,o(l.total),1),e("td",null,[e("span",{class:g(["badge",{"bg-success":l.is_paid,"bg-danger":!l.is_paid}])},o(l.is_paid?"已付款":"未付款"),3)]),e("td",te,[e("button",{onClick:M=>t(l),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 查看 ",8,le),e("button",{onClick:M=>b(l.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,se)])]))),128))])])]),e("nav",oe,[e("ul",ne,[e("li",ae,[e("button",{onClick:d[0]||(d[0]=l=>s.value=String(Number(s.value)-1)),disabled:!c.value?.has_pre,type:"button",class:g(["page-link",{disabled:!c.value?.has_pre}]),"aria-label":"Previous"},[...d[3]||(d[3]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,de)]),(u(!0),i(v,null,k(c.value?.total_pages,l=>(u(),i("li",re,[e("button",{onClick:M=>s.value=l.toString(),disabled:s.value===l.toString(),type:"button",class:g(["page-link",{active:s.value===l.toString()}])},o(l),11,ie)]))),256)),e("li",ue,[e("button",{onClick:d[1]||(d[1]=l=>s.value=String(Number(s.value)+1)),disabled:!c.value?.has_next,class:g(["page-link",{disabled:!c.value?.has_next}]),type:"button","aria-label":"Next"},[...d[4]||(d[4]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,pe)])])])])]),D(K,{ref_key:"orderDetailModalRef",ref:p,order:m.value},null,8,["order"]),D(A,{ref_key:"deleteModalRef",ref:a,title:"刪除訂單",content:"確定要刪除該訂單嗎？"},null,512)],64))}});export{be as default};
